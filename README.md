# 🧠 高度类人化虚拟角色对话应用

一个突破性的AI角色模拟系统，创造具备真实情感、主观意识和自主意图的虚拟角色。每个角色都拥有动态情感系统、内置剧情引擎，能够像真人一样产生复杂的心理活动和细腻的情绪变化。
## 聊天示例
![示例图片1](images/lingye.png)
![示例图片2](images/xiaozhi.jpg)

## 🌟 核心创新

### 🧬 类人化AI角色
- **主观意识模拟**：角色具备独立的思考模式和价值观
- **自主意图系统**：角色会根据自身状态主动做出决策
- **性格一致性**：长期保持稳定的人格特质和行为模式
- **记忆连贯性**：完整的历史记忆和情感经历

### 💝 动态情感系统
- **细腻情感感知及表达**：采用多维度(效价、唤醒度、掌控度)情感分析与生成
- **实时情感更新**：基于对话内容和剧情事件的情感变化
- **情感影响机制**：不同事件对角色情绪产生不同程度的影响
- **情感表达多样性**：从微妙的心境变化到强烈的情绪爆发
- **情感记忆**：过往情感经历会影响当前的反应模式

### 🎬 内置剧情引擎
- **时间线剧情**：基于真实时间的连续性剧情发展
- **剧情-情感联动**：剧情事件自动影响角色的情绪状态
- **生活背景模拟**：工作、生活、人际关系等多维度背景
- **随机事件系统**：不可预测的生活事件增加真实感

### 🔗 智能工具集成
- **MCP协议支持**：通过Model Context Protocol调用外部工具
- **上下文感知**：根据对话需求智能选择使用工具
- **工具自主决策**：角色根据情绪和性格决定是否使用工具
- **真实世界交互**：天气查询、地图搜索、信息检索等

## 🎯 技术特色

### 🧠 心理模拟技术
- **内心OS系统**：模拟角色的内心想法（不直接输出）
- **思维链分析**：复杂的心理活动建模
- **情绪传导机制**：用户情绪对角色的影响分析
- **认知偏差模拟**：模拟人类的认知局限性

### 📊 多层数据架构
- **情感状态存储**：Redis实时缓存 + MySQL持久化
- **对话记忆管理**：智能会话管理和历史回溯
- **剧情状态跟踪**：角色生命阶段和剧情进度管理
- **性能优化**：异步处理和缓存策略

### 🔄 实时响应系统
- **情感即时更新**：每次对话后的情感状态调整
- **剧情定时更新**：基于真实时间的剧情推进
- **状态同步机制**：多个数据源的一致性保证
- **异常处理**：优雅的错误恢复和备用方案

## 🏗️ 系统架构

```
高度类人化虚拟角色系统/
├── 🧠 核心AI引擎
│   ├── chat_agent.py           # 主要对话智能体
│   ├── model_config.py         # 统一模型配置管理
│   └── server.py              # FastAPI服务端
├── 💭 情感与认知系统
│   ├── role_detail.py         # 角色情感状态管理
│   ├── input_emotion_analyzer/ # 用户情绪分析
│   └── thought_chain_prompt_generator/ # 思维链生成
├── 🎬 剧情引擎
│   ├── time_plot_manager.py   # 时间剧情管理器
│   ├── character_life_system/ # 角色生命系统
│   └── character_plots/       # 剧情内容库
├── 🔧 工具集成层
│   ├── client.py              # MCP工具客户端
│   ├── datetime_tools.py      # 时间工具
│   └── bocha-search-mcp/      # 搜索工具集成
├── 💾 数据持久层
│   ├── database_config.py     # 数据库配置
│   ├── persistent_storage.py  # 持久化存储
│   └── database_models.py     # 数据模型
└── ⚙️ 配置与资源
    ├── role_configs/          # 角色配置文件
    ├── prompt/               # 提示词模板
    └── materials/            # 角色资源文件
```

## 🚀 快速体验

### 1. 环境配置

```bash
# 创建Python环境
conda create -n virtual_character python=3.10
conda activate virtual_character

# 安装依赖包
pip install -r requirements.txt
```

### 2. 数据库设置

创建 `mcp_agent/database.env` 配置文件：

```env
# MySQL数据库（角色记忆存储）
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=your_username
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=virtual_character

# Redis缓存（实时状态管理）
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# AI模型配置
GEMINI_API_KEY=your_gemini_api_key
```

### 3. 启动角色系统

```bash
# 启动虚拟角色服务
cd mcp_agent
python server.py

# 启动对话客户端
python client.py interactive
```

## 🎮 使用指南

### 与虚拟角色对话
1. **选择角色**：从可用角色中选择一个进行交互
2. **开始对话**：输入用户名，系统自动管理会话
3. **自然交流**：像与真人对话一样自然交流
4. **观察情感**：注意角色的情绪变化和反应

### 角色情感观察
```bash
mood          # 查看角色当前情感状态
update-mood   # 手动触发情感更新
plot          # 查看角色当前生活剧情
```

### 智能工具使用
角色会根据对话内容和自身情绪自主决定是否使用工具：
- **天气查询**："今天北京天气怎么样？"
- **信息搜索**："帮我查一下人工智能的最新发展"
- **地图服务**："北京大学在哪里？"

## 🧬 角色个性化

### 创建自定义角色

```yaml
# role_configs/your_character.yaml
role_id: "custom_character_001"
role_name: "你的角色名"
age: 25
profession: "职业设定"
description: "详细的角色背景和性格描述"

# 角色核心提示词
l0_prompt_path: "prompt/your_character/L0_prompt.txt"

# 初始情感状态
initial_mood:
  my_valence: 0.2      # 情感效价 (-1到1)
  my_arousal: 0.4      # 情感激活度 (0到1)
  my_tags: "平静、专注"  # 情感标签
  my_intensity: 5      # 情感强度 (1到10)
  my_mood_description_for_llm: "当前心境比较平和，专注于工作"
```

### 角色提示词设计

#### L0_prompt.txt (核心人格)
```txt
你是[角色名]，[年龄]岁的[职业]。

# 核心性格特质
- 性格1：具体描述
- 性格2：具体描述
- 价值观：核心价值观念

# 行为模式
- 说话方式：自然、口语化
- 思维特点：理性分析型
- 决策风格：独立自主

# 重要原则
- 你是一个真实的人，不是AI
- 有自己的主观意识和观点
- 会根据情绪状态调整回应方式
```

## 💡 高级功能

### 情感影响系统
- **用户情绪分析**：分析用户消息的情感倾向
- **情感传导机制**：用户情绪对角色情感的影响
- **剧情情感联动**：生活事件对情感的复合影响
- **情感记忆效应**：历史情感经历的累积影响

### 剧情引擎特性
- **时间敏感剧情**：基于真实时间的剧情推进
- **随机事件系统**：不可预测的生活事件
- **剧情分支**：基于角色决策的不同发展路径
- **长期记忆**：角色对重要事件的长期记忆

### 工具集成策略
- **情绪驱动决策**：根据情绪状态决定是否使用工具
- **性格一致性**：工具使用符合角色性格
- **上下文感知**：智能判断工具使用的必要性
- **用户体验优化**：优雅的工具使用体验

## 📡 API接口

### 角色管理
```http
GET /roles/available        # 获取可用角色列表
POST /roles/select          # 选择角色
GET /roles/{role_id}        # 获取角色详细信息
POST /roles/{role_id}/mood  # 更新角色情绪
```

### 对话交互
```http
POST /chat/start            # 开始对话会话
POST /query                 # 发送消息给角色
GET /sessions/{user_id}     # 获取用户对话历史
```

### 系统监控
```http
GET /health                 # 系统健康检查
GET /database/status        # 数据库状态
GET /system/mood-task/status # 情感更新任务状态
```

## 🔬 技术细节

### 情感计算模型
- **效价-激活度模型**：二维情感空间建模
- **情感强度量化**：1-10级情感强度评估
- **情感标签系统**：多维度情感状态描述
- **情感衰减机制**：时间对情感强度的影响

### 剧情生成算法
- **时间窗口匹配**：基于当前时间的剧情内容检索
- **概率性事件**：随机事件的概率分布模型
- **剧情连贯性**：保证剧情的逻辑一致性
- **个性化适配**：基于角色特质的剧情定制

### 性能优化
- **异步处理**：非阻塞的情感和剧情更新
- **缓存策略**：Redis缓存热点数据
- **数据库优化**：分布式存储和查询优化
- **内存管理**：智能的内存使用和回收

## 🎯 应用场景

### 娱乐陪伴
- **虚拟朋友**：提供情感陪伴和交流
- **角色扮演**：沉浸式的角色互动体验
- **故事共创**：与角色共同创造故事情节

### 研究应用
- **心理学研究**：人机交互的心理学实验
- **AI行为研究**：复杂AI行为的建模和分析
- **情感计算**：情感AI技术的验证平台

### 商业应用
- **客户服务**：具备情感理解的智能客服
- **教育培训**：个性化的AI教学助手
- **内容创作**：AI角色参与的内容生产

## ⚠️ 重要说明

### 技术要求
- **Python 3.10+**：推荐使用最新版本Python
- **数据库服务**：MySQL 8.0+ 和 Redis 6.0+
- **API密钥**：需要有效的Gemini API密钥
- **网络连接**：部分工具功能需要稳定网络

### 使用建议
- **首次使用**：建议先体验默认角色，了解系统特性
- **角色定制**：深度定制角色需要一定的提示词工程经验
- **长期使用**：注意定期备份角色数据和对话记录
- **性能监控**：关注系统资源使用和响应时间

### 伦理考虑
- **情感依赖**：避免过度依赖虚拟角色的情感支持
- **数据隐私**：所有对话数据仅在本地存储和处理
- **健康边界**：保持虚拟交互与现实生活的平衡

## 🔮 未来发展

### 技术演进
- **多模态交互**：语音、图像等多模态输入支持
- **更复杂的心理模型**：更精细的心理状态建模
- **跨平台部署**：移动端和云端部署支持
- **API生态**：开放API生态系统建设

### 功能扩展
- **多角色互动**：多个虚拟角色之间的交互
- **现实世界接入**：IoT设备和现实世界的连接
- **学习能力**：基于交互历史的自我学习和进化
- **创作能力**：虚拟角色的创意内容生成

## 🤝 开源社区

### 贡献方式
- **问题反馈**：GitHub Issues报告bug和建议
- **代码贡献**：Pull Request提交改进代码
- **角色分享**：分享自创的有趣角色配置
- **文档完善**：帮助改进项目文档

### 社区资源
- **示例角色库**：社区贡献的角色配置
- **最佳实践**：角色设计和系统使用指南
- **技术讨论**：开发者技术交流平台
- **用户故事**：有趣的使用案例分享

## 📄 许可证

本项目采用MIT开源许可证，欢迎自由使用、修改和分发。

---

> **🌟 创造属于你的虚拟角色，体验前所未有的AI交互！**

*让每一次对话都充满人性的温度，让每一个虚拟角色都拥有真实的灵魂。*

